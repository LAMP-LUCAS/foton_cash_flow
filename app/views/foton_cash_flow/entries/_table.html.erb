<%# plugins/foton_cash_flow/app/views/foton_cash_flow/entries/_table.html.erb %>

<table class="list entries cf-table">
  <thead>
    <tr>
      <%# Esta coluna filtra por 'id' mas ordena por 'entryDate' (data de lançamento) %>
      <th class="id-column" data-column="id" data-sort-by="entryDate" data-type="string" data-sortable="true">
        <div class="th-content">
          <span class="column-title">#</span>
          <span class="column-icons"><span class="cf-filter-icon">≡</span><span class="cf-sort-icon">▼</span></span>
        </div>
      </th>
      <th class="description-column" data-column="subject" data-type="string" data-sortable="true">
        <div class="th-content">
          <span class="column-title"><%= l('foton_cash_flow.fields.description') %></span>
          <span class="column-icons"><span class="cf-filter-icon">≡</span><span class="cf-sort-icon">▼</span></span>
        </div>
      </th>
      <th class="assignee-column" data-column="assignee" data-type="list" data-sortable="true">
        <div class="th-content">
          <span class="column-title"><%= l('foton_cash_flow.fields.assignee', default: l(:field_assigned_to)) %></span>
          <span class="column-icons"><span class="cf-filter-icon">≡</span><span class="cf-sort-icon">▼</span></span>
        </div>
      </th>
      <th class="status-column" data-column="status" data-type="list" data-sortable="true">
        <div class="th-content">
          <span class="column-title"><%= l('foton_cash_flow.fields.status') %></span>
          <span class="column-icons"><span class="cf-filter-icon">≡</span><span class="cf-sort-icon">▼</span></span>
        </div>
      </th>
      <th class="transaction-column" data-column="transactionType" data-type="list" data-sortable="true">
        <div class="th-content">
          <span class="column-title"><%= l('foton_cash_flow.fields.transaction_type') %></span>
          <span class="column-icons"><span class="cf-filter-icon">≡</span><span class="cf-sort-icon">▼</span></span>
        </div>
      </th>
      <th class="category-column" data-column="category" data-type="list" data-sortable="true">
        <div class="th-content">
          <span class="column-title"><%= l('foton_cash_flow.fields.category') %></span>
          <span class="column-icons"><span class="cf-filter-icon">≡</span><span class="cf-sort-icon">▼</span></span>
        </div>
      </th>
      <th class="value-column" data-column="amount" data-type="string" data-sortable="true">
        <div class="th-content">
          <span class="column-title"><%= l('foton_cash_flow.fields.value') %></span>
          <span class="column-icons"><span class="cf-filter-icon">≡</span><span class="cf-sort-icon">▼</span></span>
        </div>
      </th>
      <th class="start-date-column" data-column="startDate" data-type="date" data-sortable="true">
        <div class="th-content">
          <span class="column-title"><%= l('foton_cash_flow.fields.start_date', default: l(:field_start_date)) %></span>
          <span class="column-icons"><span class="cf-sort-icon">▼</span></span>
        </div>
      </th>
      <th class="entry-date-column" data-column="entryDate" data-type="date" data-sortable="true">
        <div class="th-content">
          <span class="column-title"><%= l('foton_cash_flow.fields.entry_date') %></span>
          <span class="column-icons"><span class="cf-filter-icon">≡</span><span class="cf-sort-icon">▼</span></span>
        </div>
      </th>
      <th class="actions-column"><%= l('foton_cash_flow.general.actions') %></th>
    </tr>
  </thead>
  <tbody>
    <% if @issues_for_table.any? %>
      <% @issues_for_table.each_with_index do |issue, i| %>
        <tr class="issue-row <%= issue.cash_flow_transaction_type.to_s.downcase %>"
            data-id="<%= issue.id %>"
            data-subject="<%= issue.subject %>"
            data-assignee="<%= issue.assigned_to&.name %>"
            data-status="<%= issue.status.name %>"
            data-status-key="<%= issue.status.name.parameterize %>"
            data-transaction-type="<%= issue.cash_flow_transaction_type %>"
            data-category-translated="<%= l("foton_cash_flow.cf_options.#{issue.cash_flow_category.to_s.parameterize.underscore}", default: issue.cash_flow_category) %>"
            data-category="<%= issue.cash_flow_category %>"
            data-amount="<%= issue.cash_flow_amount.to_f %>"
            data-start-date="<%= issue.start_date&.strftime('%Y-%m-%d') %>" <%# Manter ou criar helper similar se necessário %>
            data-entry-date="<%= formatted_data_attribute_date(issue) %>">
          <td class="id-column">
            <%# O número da linha é sempre visual e baseado na paginação/ordem atual %>
            <% if issue_pages %>
              <%= issue_pages.offset + i + 1 %>
            <% else %>
              <%= i + 1 %>
            <% end %>
          </td>
          <td class="description-column"><%= link_to_issue(issue) %></td> <%# link_to_issue já exibe o ID, como #123 %>
          <td class="assignee-column"><%= issue.assigned_to&.name %></td>
          <td class="status-column" data-column="status">
            <span class="status-tag <%= issue.status.name.parameterize %>">
              <%= l("foton_cash_flow.cf_options.#{issue.status.name.to_s.parameterize.underscore}", default: issue.status.name) %>
            </span>
          </td>
          <td class="transaction-column" data-column="transactionType">
            <span class="transaction-tag <%= issue.cash_flow_transaction_type.to_s.downcase %>">
              <%= l("foton_cash_flow.cf_options.#{issue.cash_flow_transaction_type.to_s.downcase}", default: issue.cash_flow_transaction_type) %>
            </span>
          </td>
          <td class="category-column" data-column="category">
            <span class="category-tag">
              <%= l("foton_cash_flow.cf_options.#{issue.cash_flow_category.to_s.parameterize.underscore}", default: issue.cash_flow_category) %>
            </span>
          </td>
          <td class="value-column <%= issue.cash_flow_transaction_type.to_s.downcase %>">
            <%= format_amount(issue.cash_flow_amount) %>
          </td>
          <td class="start-date-column"><%= format_date(issue.start_date) %></td>
          <td class="entry-date-column"><%= format_date(issue.cash_flow_entry_date) %></td>
          <td class="actions-column">
              <%= link_to l('foton_cash_flow.general.edit'), edit_issue_path(issue), class: 'icon icon-edit' %>
              <%= link_to l('foton_cash_flow.general.delete'), issue_path(issue), data: { confirm: l('foton_cash_flow.general.are_you_sure'), method: :delete }, class: 'icon icon-del' %>
          </td>

        </tr>
      <% end %>
    <% else %>
      <tr>
        <td colspan="10" class="no-data-message"><%= l('foton_cash_flow.notices.no_data_with_filters') %></td>
      </tr>
    <% end %>
  </tbody>
</table>