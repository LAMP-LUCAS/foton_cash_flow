/*
 * Foton Cash Flow - Folha de Estilos Principal
 * Versão: 2.0
 * Descrição: Estilos unificados para o plugin de Fluxo de Caixa.
*/

/* ==========================================================================
   1. VARIÁVEIS GLOBAIS E RESET
   ========================================================================== */
:root {
  /* Cores Primárias */
  --primary-color: #3F51B5;
  --primary-hover: #303F9F;
  --text-on-primary: #FFFFFF;

  /* Cores de Feedback */
  --success-color: #28a745;
  --warning-color: #ffc107;
  --error-color: #dc3545;

  /* Cores de Fundo e Texto */
  --background-white: #fff;
  --background-light: #f8f9fa;
  --text-color: #333333;
  --text-light: #6c757d;
  --border-color: #e0e0e0;

  /* Cores para Pílulas (Tags) */
  --pill-bg-green: rgba(40, 167, 69, 0.1);
  --pill-text-green: #28a745;
  --pill-bg-red: rgba(220, 53, 69, 0.1);
  --pill-text-red: #dc3545;
  --pill-bg-blue: rgba(0, 123, 255, 0.1);
  --pill-text-blue: #007bff;
  --pill-bg-gray: rgba(108, 117, 125, 0.15);
  --pill-text-gray: #6c757d;

  /* Métricas e Efeitos */
  --border-radius: 6px;
  --box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
  --transition: all 0.2s ease-in-out;
}

/* ==========================================================================
   2. LAYOUT PRINCIPAL
   ========================================================================== */
.cash-flow-page {
  padding: 24px 0;
}

.cf-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 24px;
  padding-bottom: 16px;
  border-bottom: 1px solid var(--border-color);
}

.cf-main-content {
  display: flex;
  gap: 24px;
  align-items: flex-start;
}

.cf-table-section {
  flex: 1;
  min-width: 0; /* Previne overflow em flex container */
}

.cf-summary-section {
  width: 280px;
  flex-shrink: 0;
  position: sticky; /* Mantém o sumário visível ao rolar */
  top: 20px;
}

/* ==========================================================================
   3. COMPONENTES (Botões, Cards, Dropdowns, Pílulas)
   ========================================================================== */

/* --- Botões --- */
.cf-btn {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
  padding: 8px 16px;
  border-radius: var(--border-radius);
  border: 1px solid transparent;
  font-weight: 500;
  cursor: pointer;
  transition: var(--transition);
  text-decoration: none !important;
}
.cf-btn:hover {
  transform: translateY(-1px);
}
.cf-btn-primary {
  background: var(--primary-color);
  color: var(--text-on-primary);
  border-color: var(--primary-color);
}
.cf-btn-primary:hover {
  background: var(--primary-hover);
  border-color: var(--primary-hover);
}
.cf-btn-secondary {
  background: var(--background-white);
  color: var(--text-color);
  border-color: var(--border-color);
}
.cf-btn-secondary:hover {
  background: var(--background-light);
  border-color: #ccc;
}
.cf-btn-danger {
  background: var(--error-color);
  color: var(--text-on-primary);
  border-color: var(--error-color);
}

/* --- Cards de Sumário --- */
.cf-summary {
  display: flex;
  flex-direction: column;
  gap: 16px;
}
.cf-card {
  background: var(--background-white);
  border-radius: var(--border-radius);
  border: 1px solid var(--border-color);
  padding: 16px;
}
.cf-card-label {
  font-size: 0.9rem;
  color: var(--text-light);
  margin-bottom: 8px;
}
.cf-card-value {
  font-size: 1.5rem;
  font-weight: 600;
}
.cf-card-value.cf-success { color: var(--success-color); }
.cf-card-value.cf-danger { color: var(--error-color); }

/* --- Menu Dropdown --- */
.cf-dropdown {
  position: relative;
  display: inline-block;
}
.cf-dropdown-menu {
  display: none;
  position: absolute;
  right: 0;
  top: calc(100% + 5px);
  background-color: var(--background-white);
  min-width: 200px;
  box-shadow: var(--box-shadow);
  z-index: 100;
  border-radius: var(--border-radius);
  border: 1px solid var(--border-color);
  overflow: hidden;
}
.cf-dropdown-menu.show { display: block; }
.cf-dropdown-item {
  color: var(--text-color);
  padding: 10px 14px;
  text-decoration: none;
  display: flex;
  align-items: center;
  gap: 10px;
}
.cf-dropdown-item:hover {
  background-color: var(--background-light);
}

/* --- Pílulas (Tags) Unificadas --- */
.cf-pill {
  display: inline-block;
  padding: 4px 10px;
  border-radius: 12px;
  font-size: 0.85em;
  font-weight: 500;
  line-height: 1.2;
  white-space: nowrap;
}
.cf-pill.type-revenue { background-color: var(--pill-bg-green); color: var(--pill-text-green); }
.cf-pill.type-expense { background-color: var(--pill-bg-red); color: var(--pill-text-red); }
.cf-pill.status { background-color: var(--pill-bg-blue); color: var(--pill-text-blue); }
.cf-pill.category { background-color: var(--pill-bg-gray); color: var(--pill-text-gray); }


/* ==========================================================================
   4. TABELA E INTERAÇÕES
   ========================================================================== */
.cf-table-container {
  background: var(--background-white);
  border-radius: var(--border-radius);
  border: 1px solid var(--border-color);
  overflow: hidden; /* Garante que a borda arredondada funcione */
}

.cf-table-wrapper {
  max-height: 65vh; /* ALTURA FIXA DA TABELA */
  overflow-x: auto; /* Rolagem horizontal se necessário */
  overflow-y: auto; /* Rolagem vertical */
}

.cf-table {
  width: 100%;
  border-collapse: collapse;
}

.cf-table th, .cf-table td {
  padding: 12px 16px;
  text-align: left;
  vertical-align: middle;
  border-bottom: 1px solid var(--border-color);
}

.cf-table thead th {
  position: sticky;
  top: 0;
  background: var(--background-light);
  font-size: 0.9rem;
  font-weight: 500;
  color: var(--text-light);
  text-transform: uppercase;
  cursor: default; /* O cursor pointer vai para os ícones */
}

/*
  Solução Definitiva para Alinhamento de Cabeçalho:
  - O wrapper .th-content se torna um container de posicionamento.
  - Os ícones são posicionados de forma absoluta à direita, garantindo que nunca quebrem o layout.
*/
.th-content {
  position: relative;
  padding-right: 40px; /* Espaço para os ícones não sobreporem o texto */
  width: 100%;
  box-sizing: border-box;
}

.column-title {
  display: block; /* Garante que o título ocupe a linha */
  margin: 0.3rem;
  margin-right: 0.9rem;
  text-align: center;
}

.column-icons {
  position: absolute;
  right: 0;
  top: 50%;
  transform: translateY(-50%);
  display: flex;
  align-items: center;
  gap: 6px;
}

.cf-table tbody tr:hover {
  background-color: var(--background-light);
}

.cf-table .value-column.revenue { color: var(--success-color); }
.cf-table .value-column.expense { color: var(--error-color); }
.cf-table .actions-column { text-align: right; }
.cf-table .actions-column a { margin-left: 12px; }

/* --- Paginação --- */
.cf-pagination-container {
  padding: 16px;
  border-top: 1px solid var(--border-color);
}

.cf-pagination {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 10px;
  flex-wrap: wrap;
}

.cf-pagination-btn {
  display: inline-flex;
  align-items: center;
  gap: 6px;
  padding: 6px 12px;
  border: 1px solid var(--border-color);
  border-radius: 4px;
  background: white;
  color: var(--text-color);
  cursor: pointer;
  transition: all 0.2s;
}

.cf-pagination-btn:hover:not(.disabled) {
  background: var(--background-light);
  border-color: var(--primary-color);
}

.cf-pagination-btn.disabled {
  opacity: 0.5;
  cursor: not-allowed;
}

.cf-pagination-pages {
  display: flex;
  gap: 4px;
}

.cf-pagination-page {
  min-width: 32px;
  height: 32px;
  display: flex;
  align-items: center;
  justify-content: center;
  border: 1px solid var(--border-color);
  border-radius: 4px;
  background: white;
  color: var(--text-color);
  cursor: pointer;
  transition: all 0.2s;
}

.cf-pagination-page:hover:not(.active) {
  background: var(--background-light);
  border-color: var(--primary-color);
}

.cf-pagination-page.active {
  background: var(--primary-color);
  color: white;
  border-color: var(--primary-color);
}

.cf-pagination-ellipsis {
  display: flex;
  align-items: center;
  height: 32px;
  padding: 0 4px;
  color: var(--text-color);
}


/* ==========================================================================
   5. FILTROS (Estilo Notion)
   ========================================================================== */

/* NOVO: Estilo unificado para ícones no cabeçalho */
/*
  Regra explícita para garantir que os ícones sejam renderizados.
  Isso previne que eles "colapsem" para tamanho zero se os estilos
  base do Redmine forem insuficientes ou entrarem em conflito.
  As classes .icon, .icon-filter, etc., do Redmine fornecem o caractere do ícone
  via pseudo-elemento ::before.
*/
.cf-filter-icon, .cf-sort-icon {
  opacity: 0.5;
  transition: var(--transition);
  cursor: pointer;
  font-weight: bold;
}

/* Efeito de hover nos ícones */
.column-icons:hover .cf-filter-icon,
.column-icons:hover .cf-sort-icon {
  opacity: 1;
}

/* Ícone de filtro ativo */
.cf-table thead th .cf-filter-icon.active {
  opacity: 1;
  color: var(--primary-color);
}

/* --- Barra de Filtros Ativos --- */
#cf-active-filters-bar {
  padding: 0 16px 12px 16px;
  display: flex;
  flex-wrap: wrap;
  gap: 10px;
  min-height: 20px; /* Garante espaço mesmo quando vazia */
}

/* --- Pílula de Filtro Ativo --- */
.cf-filter-pill {
  display: flex;
  align-items: center;
  gap: 8px;
  background-color: var(--background-light);
  border: 1px solid var(--border-color);
  border-radius: var(--border-radius);
  padding: 4px 8px;
  font-size: 0.9em;
  cursor: pointer;
  transition: var(--transition);
}
.cf-filter-pill:hover {
  border-color: #ccc;
  background-color: #eef0f2;
}
.cf-filter-pill .pill-remove-btn {
  /* Garante que o ícone 'x' seja visível e clicável */
  display: inline-flex;
  align-items: center;
  justify-content: center;
  width: 16px;
  height: 16px;
  background: rgba(0,0,0,0.08);
  border: none;
  border-radius: 50%;
  cursor: pointer;
  padding: 0;
  margin-left: 4px;
  font-size: 1em;
  line-height: 1;
  color: var(--text-light);
  transition: var(--transition);
}
.cf-filter-pill:hover .pill-remove-btn {
  background: rgba(0,0,0,0.15);
  color: var(--text-color);
}

/* --- Botão de Limpar Todos os Filtros --- */
.cf-clear-all-btn {
  background: none;
  border: none;
  color: var(--primary-color);
  text-decoration: underline;
  cursor: pointer;
  font-size: 0.9em;
  padding: 4px 8px;
  margin-left: auto; /* Alinha o botão à direita da barra de filtros */
}
.cf-clear-all-btn:hover {
  color: var(--primary-hover);
}

/* --- Popup de Filtro --- */
.cf-filter-popup {
  display: none; /* Oculto por padrão, controlado por JS */
  position: absolute;
  z-index: 1010;
  background: var(--background-white);
  border: 1px solid var(--border-color);
  border-radius: var(--border-radius);
  box-shadow: var(--box-shadow);
  width: 320px;
}
.cf-popup-content {
  padding: 12px;
}
.cf-popup-content p {
  margin: 0 0 12px 0;
  color: var(--text-light);
}
.cf-popup-content p strong {
  color: var(--text-color);
}

/* Estilos para o filtro de data */
.cf-filter-date-range {
  display: flex;
  align-items: center;
  gap: 8px;
  margin-bottom: 12px;
}
.cf-filter-date-range input[type="date"] {
  flex: 1;
  padding: 8px;
  border: 1px solid var(--border-color);
  border-radius: var(--border-radius);
  font-family: inherit;
  font-size: 0.9em;
}

/* Estilos para a lista de checkboxes */
.cf-filter-checklist {
  max-height: 200px;
  overflow-y: auto;
  border: 1px solid var(--border-color);
  border-radius: var(--border-radius);
  padding: 4px;
  margin-bottom: 12px;
}
.cf-filter-checklist-item {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 6px 8px;
  border-radius: 4px;
  cursor: pointer;
  transition: background-color 0.2s;
}
.cf-filter-checklist-item:hover {
  background-color: var(--background-light);
}

.cf-filter-popup-body {
  padding: 12px;
}
.cf-filter-popup-footer {
  padding: 8px 12px;
  border-top: 1px solid var(--border-color);
  display: flex;
  justify-content: space-between;
}
.cf-filter-group {
  display: flex;
  flex-direction: column;
  gap: 8px;
}
.cf-filter-group select,
.cf-filter-group input[type="text"],
.cf-filter-group input[type="number"],
.cf-filter-group input[type="date"] {
  width: 100%;
  box-sizing: border-box;
  padding: 8px;
  border: 1px solid var(--border-color);
  border-radius: var(--border-radius);
}
.cf-filter-number-inputs, .cf-filter-date-inputs {
  display: flex;
  align-items: center;
  gap: 8px;
}

/* ==========================================================================
   6. MODAIS
   ========================================================================== */
.cf-modal-overlay {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background-color: rgba(0, 0, 0, 0.5);
  display: none; /* Alterado para 'none' por padrão */
  align-items: center;
  justify-content: center;
  z-index: 1050;
}
.cf-modal-overlay.show {
  display: flex; /* Mostra o modal */
}
.cf-modal-content {
  background: var(--background-white);
  border-radius: var(--border-radius);
  box-shadow: 0 5px 15px rgba(0,0,0,0.2);
  width: 90%;
  max-width: 500px;
}
.cf-modal-header {
  padding: 16px;
  border-bottom: 1px solid var(--border-color);
  display: flex;
  justify-content: space-between;
  align-items: center;
}
.cf-modal-header h5 { margin: 0; font-size: 1.2rem; }
.cf-modal-close-btn { background: none; border: none; font-size: 1.5rem; cursor: pointer; opacity: 0.5; }
.cf-modal-close-btn:hover { opacity: 1; }
.cf-modal-body { padding: 16px; }
.cf-modal-footer {
  padding: 16px;
  border-top: 1px solid var(--border-color);
  display: flex;
  justify-content: flex-end;
  gap: 12px;
}

/* ==========================================================================
   7. GRÁFICOS
   ========================================================================== */
.cf-charts-container {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
  gap: 24px;
  margin-top: 24px;
}
.cf-chart-card {
  background: var(--background-white);
  border-radius: var(--border-radius);
  border: 1px solid var(--border-color);
  padding: 16px;
}
.cf-chart-title {
  font-size: 1.1rem;
  font-weight: 600;
  margin-bottom: 16px;
}

/* ==========================================================================
   8. RESPONSIVIDADE
   ========================================================================== */
@media (max-width: 992px) {
  .cf-main-content {
    flex-direction: column;
  }
  .cf-summary-section {
    width: 100%;
    position: static; /* Remove o sticky em telas menores */
  }
  .cf-summary {
    flex-direction: row;
    justify-content: space-around;
  }
  .cf-summary .cf-card {
    flex: 1;
  }
  .cf-table-wrapper {
    max-height: none; /* Remove altura fixa em telas menores */
  }
}
